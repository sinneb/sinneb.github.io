<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.49.2" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Sawtooth VCO design &middot; sinneb</title>

  

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">

  <link type="text/css" rel="stylesheet" href="https://sinneb.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://sinneb.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://sinneb.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://sinneb.github.io/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="sinneb" />

  
</head>

  <body class="theme-base-10 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://sinneb.github.io/"><h1 style="margin-bottom: 0;">sinneb</h1></a>
      <p class="lead">
       tech* and musical instruments 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://sinneb.github.io/" style="font-size: 0.9rem;">&raquo; home</a> </li>
        <li><a href="/about/"  style="font-size: 0.9rem;">&raquo; about </a></li>
        <br/>
        <a href="https://www.youtube.com/channel/UCQE_f-WmzqNzLFS4kBaUKDQ" target="_blank"><i class="fab fa-youtube"></i></a>&nbsp;&nbsp;
        <a href="https://www.instagram.com/sinneb_musictech/" target="_blank"><i class="fab fa-instagram"></i></a>
      </ul>
    </nav>

    <p> </p>
    <br/><br/>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Sawtooth VCO design</h1>
  <time datetime=2012-07-01T21:22:12Z class="post-date">Sun, Jul 1, 2012</time>
  <p>Time for a new post and I have an interesting prototype to share with you. Tom Wiltshire over at electric druid (<a href="http://www.electricdruid.net/" target="_blank"><a href="http://www.electricdruid.net/" target="_blank">http://www.electricdruid.net/</a></a>) made a great writeup about the Roland Juno DCO workings (a true must read). Based upon the diagram I decided to give it a go.</p>

<p><a href="/uploads/2012/06/JunoDCOwaveshaper.gif"><img class="alignnone size-full wp-image-518" title="JunoDCOwaveshaper" alt="" src="/uploads/2012/06/JunoDCOwaveshaper.gif" width="522" height="266" srcset="/uploads/2012/06/JunoDCOwaveshaper.gif 522w, /uploads/2012/06/JunoDCOwaveshaper-300x152.gif 300w" sizes="(max-width: 522px) 100vw, 522px" /></a></p>

<p>_from <a href="http://www.electricdruid.net/" target="_blank"><a href="http://www.electricdruid.net/" target="_blank">http://www.electricdruid.net/</a></a>, used with permission._</p>

<p>I did some redesign work, since an Arduino is a very handy a capable device for such applications. So, in general the circuit looks and works like this:</p>

<p><a href="/uploads/2012/06/sawtoothvco_meta.png"><img class="alignnone size-full wp-image-521" title="sawtoothvco_meta" alt="" src="/uploads/2012/06/sawtoothvco_meta.png" width="500" height="272" srcset="/uploads/2012/06/sawtoothvco_meta.png 500w, /uploads/2012/06/sawtoothvco_meta-300x163.png 300w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>

<p>The opamp integrator &#8220;fills&#8221; the capacitor to generate the upwards ramp. Reset pulses aren&#8217;t coming from a 8253 (although I have used those in the past) but from an Arduino generating a PWM wave with a very short &#8220;on&#8221; time, an almost 0% duty cycle. This results in a direct usable reset pulse for the integrator. This reset pulse is executed by the 4066 switch. When the switch is on, the integrator is set to ground and resets to 0V. The switch is turned off again and the integrating starts again.</p>

<p><a href="/uploads/2012/06/PWMinsteadof8253.png"><img class="alignnone size-full wp-image-519" title="PWMinsteadof8253" alt="" src="/uploads/2012/06/PWMinsteadof8253.png" width="500" height="375" srcset="/uploads/2012/06/PWMinsteadof8253.png 500w, /uploads/2012/06/PWMinsteadof8253-300x225.png 300w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>

<p><em>Compare both solutions. The Roland DCO uses a programmable divider and a capacitor / resistor / transistor network for the reset pulses (left). My solution uses a PWM signals generated by an Arduino to trigger a 4066 switch ic to reset the integrator (right)</em></p>

<p>Because the speed of integration varies, the current supplied to the integrator has to vary with that speed. A higher speed (a higher frequency sawtooth wave eg more sawtooths per second) requires more current to nicely reach the upper limit. A lower frequency has to rise slowly towards the upper limit. I solved this with a DAC also controlled by the Arduino. This corresponds to the Roland solution, although the &#8220;range switch&#8221; is not needed anymore because of the range of the DAC.</p>

<p><a href="/uploads/2012/06/daccurrent.png"><img class="alignnone size-full wp-image-520" title="daccurrent" alt="" src="/uploads/2012/06/daccurrent.png" width="500" height="281" srcset="/uploads/2012/06/daccurrent.png 500w, /uploads/2012/06/daccurrent-300x168.png 300w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>

<p><em>The Roland solution had a certain DCO CV which is fed into the integrator via a 4052 switch and a capacitor. My solution uses an Arduino driven DAC (MCP4921) and a opamp buffer to add the required current to the integrator.</em></p>

<p>In LTSpice, the following circuit was developed and simulated:</p>

<p><a href="/uploads/2012/06/sawtoothvco_large.png"><img class="alignnone size-medium wp-image-523" title="sawtoothvco_large" alt="" src="/uploads/2012/06/sawtoothvco_large-300x154.png" width="300" height="154" srcset="/uploads/2012/06/sawtoothvco_large-300x154.png 300w, /uploads/2012/06/sawtoothvco_large-1024x527.png 1024w, /uploads/2012/06/sawtoothvco_large.png 1167w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<p><em>click to enlarge. Grab <a href="/uploads/2012/06/sawtoothVCO.pdf">pdf</a></em></p>

<p>Simulation results in a nice looking, and more important very raw sounding sawtooth waveform.</p>

<p><a href="/uploads/2012/06/sawtooth_sim.png"><img class="alignnone size-full wp-image-525" title="sawtooth_sim" alt="" src="/uploads/2012/06/sawtooth_sim.png" width="500" height="313" srcset="/uploads/2012/06/sawtooth_sim.png 500w, /uploads/2012/06/sawtooth_sim-300x187.png 300w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>

<p>Look at it</p>

<p><a href="/uploads/2011/07/vco1_test1.wav">Listen to it</a> (same example as in a previous post)</p>

<p>I even build a prototype of this design. The PCB design was made in Eagle.</p>

<p><a href="/uploads/2012/07/eagle_prototype.png"><img class="alignnone size-medium wp-image-528" title="eagle_prototype" alt="" src="/uploads/2012/07/eagle_prototype-300x194.png" width="300" height="194" srcset="/uploads/2012/07/eagle_prototype-300x194.png 300w, /uploads/2012/07/eagle_prototype.png 1005w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<p><em>click to enlarge</em></p>

<p>Unfortunately I cannot find the Arduino code. The idea is that upon a note change (through midi) the new note frequency gets translated to a PWM frequency with duty cycle as close to 0% as possible. This PWM wave is used to trigger the 4066 switch. Furthermore, the DAC needs to be supplied with a value also depended on the requested frequency. This last ratio was experimentally found by me and put in a reference array.</p>

<p>Work is also needed at the &#8220;fix&#8221; stage: the level shifters (sawtooth should nicely fold around 0V) and the peak to peak voltage. Upon finding the best values for a certain frequency range, the fix stage can be build around that.</p>

<p>Thanks to everybody on the internet for inspiration for this design. Probably used a lot more sources then the ones mentioned in this article!</p>

</div>


    </main>

    
  </body>
</html>
